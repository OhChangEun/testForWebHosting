<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1" />
    <title>다음API</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- 주소 검색 -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        $(document).ready(function () {
            showzip = function () {
                var element_layer = document.getElementById('layer');
                new daum.Postcode({
                    oncomplete: function (data) {
                        // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분입니다.
                        // 예제를 참고하여 다양한 활용법을 확인해 보세요.

                        // 부모 창에 메시지를 전송
                        window.parent.postMessage({
                            zonecode: data.zonecode,
                            address: data.address
                        }, '*');
                    }
                }).embed(element_layer);
            }

            // 새로 추가한 부분: 버튼 클릭 시 부모 창으로 메시지 전송
            $("#btnCommunicate").on("click", function () {
                // 부모 창에 메시지를 전송
                window.parent.postMessage({ action: 'CallCSharp' }, '*');
            });

            showzip();
        });

        // 새로 추가한 부분: 부모 창으로부터 메시지를 수신
        window.addEventListener('message', function (event) {
            if (event.data.action === 'CallForm') {
                // 받은 데이터를 처리
                alert(`Received Zip Code: ${event.data.zonecode}\nReceived Address: ${event.data.address}`);
                // 여기에서 원하는 작업을 수행하면 됩니다.
            }
        });
    </script>
</head>
<body>
    <div id='layer' style='position:fixed;overflow:hidden;z-index:1;-webkit-overflow-scrolling:touch;'></div>
</body>
</html>